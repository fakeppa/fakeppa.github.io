---
icon: pen-to-square
date: 2025-02-26
tags: 
title: 2.10 STP生成树协议
category:
  - 项目
---
# 1.BPDU报文
桥协议数据单元，生成树的协商报文，BPDU报文被封装在**以太网802.3**数据帧中
目的MAC是组播MAC，48位二进制数据中如果第八位为1则为组播，为0，则单播
- 配置BPDU：用来生成树计算和维护生成树拓补的报文，当竞选或维护时由根桥发出，宣告根的地位
- TCN BPDU：拓补变化通知BPDU，有新接入时由新设备发送，重新组织拓补结构 
![image.png](https://cdn.jsdelivr.net/gh/fakeppa/blog-img/20250226204651.png)
 该图为配置BPDU的报文格式，画出的四个字段比较重要
 - Root Identifier:当前根桥的BID，由桥优先级和MAC地址组成，优先级默认为32768
 - Root Path Cost：根路径开销
 - Bridge Identifier：本交换机的BID
 - Port Identifier：发送该BPDU的端口ID，有端口优先级和端口编号组成，优先级默认为128（8为二进制组成）
# 2.
STP根桥、根端口、和指定端口的选举原则
1. 根网桥的选举规则(***所有交换机选一个根交换机***)：
	- 首先，比优先级，优先级小者优先
	- 其次，比MAC地址，MAC地址小者优先。
2. 根端口（RP）的选举原则（每个非根交换机选一个根端口）：
	- 首先，选择根路径开销（Root Path Cost，RPC）最低的端口；
	- 其次，若有多个端口的RPC相等，选择对端桥ID最低的端口；
	- 最后若有多个端口的对端桥ID相等，选择对端端口ID最低的端口。
		（三步比不出来，就比本端口小者）
3. 指定端口（DP）的选举原则（每个二层链路选一个指定端口）：
	- 首先，选择根路径开销（Root Path Cost ， RPC）最低的端口；
	- 其次，若有多个端口的RPC相同，选择桥ID最低的端口；
	- 最后，若有多个端口的桥ID相等，选择端口ID最低的端口